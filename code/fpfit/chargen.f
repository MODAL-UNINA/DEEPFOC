cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
      SUBROUTINE CHARGEN(X,Y,IPEN,NXYC,ICHAR,ICHRL)
c     Borrowed from Ron Wahl plot package.
C
      DIMENSION X(1),Y(1),IPEN(1)
C
C  THE FOLLOWING CHARACTER CONSTANTS ARE GENERATED FOR
C  A 32 OR 36 BIT MACHINE WITH STANDARD ASCII CHARACTER
C  SET.
C
      DIMENSION ICODE(190),ICA(76),ICB(76),ICC(38),
     1  INDX(128)
C
      EQUIVALENCE (ICODE(1),ICA(1)),(ICODE(77),ICB(1)),
     1   (ICODE(153),ICC(1))
C
      DATA ICA/
     1    1797120,   58406463,  847319000,   34695604,
     2  953683920,  906230790,  820090744, 1068285446,
     3  856655768,  419377407,  913277339,  105979967,
     4  953828664,  575375524,  114823152,  503836720,
     5  895742065,  594277893,  469607644,  513465123,
     6  184399125,  942853674,  509867046,  206986040,
     7 1068110922,  167652043,  753051730,  972862755,
     8  673446733, 1068808824,  724011528,  946180045,
     9  441837914,  377083199,  764643157, 1068915118,
     1  414943112,  216050360,  558149612,  355547370,
     2  410749733,  383967807,  945411341,  428513305,
     3  155290303,  224029514,  628357644, 1066784678,
     4 1064912024, 1064978584,  311658329,  585282296,
     5  950845396,  274986589,  367363665,  285127423,
     6 1061230168,  541326216,  271411627, 1063380351,
     7  750151053,  251560457,  699020526,  553423904,
     8  167682726,  615421968, 1069081300,  699020490,
     9  506500128,  246976494,  270836991,  328116832,
     1  765027148,  405010668,  224029546, 1068643532/
      DATA ICB/
     1  324126419,  425788536,  476921809,  274957524,
     2  367363665, 1069070975,  213093002, 1060549247,
     3  750151053,  409437851,  203754047,  564840789,
     4  745616537,  950133311,  590346386,  138046316,
     5 1066314336,  220530729,  150919574,  547805582,
     6  948748232, 1067484078,  602071944,  698986443,
     7  372544544,  237239142,  786608888,  947982312,
     8  643532696,  541102783,  237239209,  333636280,
     9  673247208,  778625599,  674795496,  541106158,
     1  224029545,  641241033, 1059994413,  765854729,
     2  941938086,  237238810,  193907558,  167675640,
     3  598382608,  643355411,  947490797,  154925966,
     4 1069193232,  251586062, 1069156112,  674990984,
     5  786543551,  775681563,  277084680,  675019158,
     6  379192383,  949085503,  191624734, 1068285468,
     7  155322984,  615422098,  237236948,  730940152,
     8 1059391529,  186976297,  687782164,  345161262,
     9  696320587,  615424703,  541102804,  628708415,
     1  704525560,  338465824,  968067812, 1060190444/
      DATA ICC/
     1  338658184,  419334884, 1064951324,  982627641,
     2 1067081252,  741049224,  419332792,  942706654,
     3  945927435, 1067628827,  338658056,  285117156,
     4  345160288,  167576139,  615421968,  959677140,
     5  276996043,  730940105, 1068473144,  338658056,
     6  271055588,  189409888,  419346708, 1066487326,
     7  696320588,  218024504,  271842072,  150915099,
     8 1067503148,  753009676,  217921273,  553550380,
     9  493958809,  946442214,  423884700,  376817882,
     1  781542271,         63/
      DATA INDX/
     1    -1,   16,   33,   50,   82,   99,  144,  161,
     2   164,  193,  242,  259,  275,  291,   -1,   -1,
     3    -1,   -1,   -1,   -1,   -1,   -1,   -1,   -1,
     4   308,  340,  371,  416,  420,  452,  467,  496,
     5    -1,  514,  545,  592,  626,  673,  721,  755,
     6   784,  800,  816,  850,  867,  897,  900,  928,
     7   931,  961,  976,  996, 1028, 1044, 1088, 1122,
     8  1137, 1187, 1232, 1266, 1313, 1328, 1345, 1360,
     9  1393, 1441, 1459, 1504, 1524, 1554, 1584, 1602,
     1  1635, 1666, 1697, 1715, 1746, 1761, 1778, 1794,
     2  1826, 1856, 1891, 1924, 1970, 1987, 2016, 2020,
     3  2048, 2065, 2083, 2099, 2115, 2129, 2145, 2163,
     4    -1, 2192, 2227, 2272, 2292, 2337, 2369, 2388,
     5  2448, 2468, 2496, 2528, 2548, 2562, 2608, 2628,
     6  2660, 2706, 2752, 2771, 2804, 2832, 2852, 2867,
     7  2884, 2912, 2932, 2948, 2978, 2995, 3025,   -1/
C
      DATA NWPW/ 5/
C
c      I=IAND(ICHAR,255)
      i = mod (ichar, 256)
      NXY=INDX(I+1)
      IF (NXY.GT.0) GO TO 5
      ICHAR=0
      RETURN
    5 ICHRL=ICHAR
C
      IF (ICHAR.GT.255.AND.I.GT.23) GO TO 10
      ITA=0
      GO TO 20
   10 ITA=1
C
C  INITIALIZE
c   20 N=IAND(NXY,15)
   20 n = mod (nxy, 16)
      NXY=NXY/16
      IW=ICODE(NXY)
      IF (N.EQ.0) GO TO 40
      DO 30 I=1,N
        IW=IW/64
   30   CONTINUE
   40 I1=NWPW-N
      IP=1
      LZ=0
      N=0
      DO 120 J=1,15
        DO 110 I=1,I1
c          IXY=IAND(IW,63)
          ixy = mod (iw, 64)
          IF (IXY-56) 50,60,70
C
C  X-Y COORDINATE
   50     N=N+1
c          Y(N)=FLOAT(IAND(IXY,7)-LZ)
          y(n)=float(mod(ixy,8)-lz)
          X(N)=FLOAT(IXY/8)
          IF (ITA.NE.0) X(N)=X(N)+.333333*Y(N)
          IPEN(N)=IP
          IP=0
          GO TO 100
C
C  PEN DOWN CONDITION
   60     IP=1
          GO TO 100
C
C  OTHER CONTROLS
   70     IF (IXY-58) 80,90,130
C
C  LOWER ZONE
   80     LZ=6
          GO TO 100
C
C  UPPER ZONE
   90     LZ=0
C
  100       IW=IW/64
  110     CONTINUE
        NXY=NXY+1
        IW=ICODE(NXY)
        I1=NWPW
  120   CONTINUE
C
  130 NXYC=N
C
      RETURN
C
      END


